{"ast":null,"code":"import _taggedTemplateLiteral from \"@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/loel/Documents/loel-blog/pages/edit/index.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 0;\\n  padding: 0 0.5rem;\\n  width: 100%;\\n  height: 2.5rem;\\n  font-size: 0.875rem;\\n  font-weight: 400;\\n  border: 1px solid #e5e5e5;\\n  border-radius: 4px;\\n\\n  :hover,\\n  :focus {\\n    border-color: hsl(0, 0%, 70%);\\n  }\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n  margin-left: auto;\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  margin-right: 1rem;\\n  width: 300px;\\n  font-size: 0.875rem;\\n  z-index: 3;\\n\\n  > div {\\n    border-color: #e5e5e5;\\n  }\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  margin-bottom: 1rem;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport dynamic from \"next/dynamic\";\nimport React, { useEffect, useState } from \"react\";\nimport service from \"../../utils/service\";\nimport Select from \"react-select\";\nimport { EmptyLayout } from \"layouts\";\nimport { Button } from \"styles\";\nimport \"codemirror/lib/codemirror.css\";\nimport \"@toast-ui/editor/dist/toastui-editor.css\";\nimport \"tui-color-picker/dist/tui-color-picker.css\";\nimport \"highlight.js/styles/railscasts.css\";\nimport styled from \"styles/styled\";\nimport { useRouter } from \"next/router\";\nimport { useMutation, useQuery } from \"@apollo/react-hooks\";\nimport { CREATE_POST, MODIFY_POST, GET_POST } from \"@api/Post\";\nimport { GET_CATEGORIES } from \"@api/Category\";\nvar Editor = dynamic(_c = function _c() {\n  return import(\"components/TuiEditorWrapper\");\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"components/TuiEditorWrapper\")];\n    },\n    modules: [\"components/TuiEditorWrapper\"]\n  }\n});\n_c2 = Editor;\nvar EditorWithForwardedRef = /*#__PURE__*/React.forwardRef(_c3 = function _c3(props, ref) {\n  return /*#__PURE__*/_jsxDEV(Editor, _objectSpread(_objectSpread({}, props), {}, {\n    forwardedRef: ref\n  }), void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 26,\n    columnNumber: 3\n  }, _this);\n});\n_c4 = EditorWithForwardedRef;\n\nvar WysiwygEditor = function WysiwygEditor() {\n  _s();\n\n  var router = useRouter();\n  var id = router.query.id;\n\n  var _useState = useState({\n    title: \"\",\n    category: \"\",\n    html: \"\",\n    html2: \"\",\n    email: \"ru_bryunak@naver.com\",\n    markdown: \"\"\n  }),\n      post = _useState[0],\n      setPost = _useState[1];\n\n  var _useState2 = useState([]),\n      image = _useState2[0],\n      setImage = _useState2[1];\n\n  var _useState3 = useState([]),\n      options = _useState3[0],\n      setOptions = _useState3[1];\n\n  var editorRef = React.useRef();\n  var imageUploadRef = React.useRef(null);\n  useQuery(GET_CATEGORIES, {\n    fetchPolicy: \"cache-first\",\n    onCompleted: function onCompleted(data) {\n      var dummy = data.getCategories.reduce(function (acc, cur) {\n        acc.push({\n          value: cur.category.toLowerCase(),\n          label: cur.category\n        });\n        return acc;\n      }, []);\n      setOptions(dummy);\n    }\n  });\n  useQuery(GET_POST, {\n    fetchPolicy: \"network-only\",\n    variables: {\n      id: id\n    },\n    skip: !id,\n    onCompleted: function onCompleted(data) {\n      var post = data.getPost;\n      setPost({\n        email: post.user.email,\n        category: post.category,\n        title: post.title,\n        html: post.html,\n        markdown: post.markdown,\n        image: post.image,\n        html2: post.html2\n      });\n    }\n  });\n\n  var handleChange = function handleChange() {\n    if (!editorRef.current) {\n      return;\n    }\n\n    var instance = editorRef.current.getInstance();\n    var html2 = document.querySelector(\".tui-editor-contents\").innerHTML;\n    setPost(_objectSpread(_objectSpread({}, post), {}, {\n      html: instance.getHtml(),\n      html2: html2,\n      markdown: instance.getMarkdown()\n    }));\n  };\n\n  var handleSelect = function handleSelect(newValue) {\n    if (newValue) {\n      setPost(_objectSpread(_objectSpread({}, post), {}, {\n        category: newValue.value\n      }));\n    } else {\n      setPost(_objectSpread(_objectSpread({}, post), {}, {\n        category: null\n      }));\n    }\n  };\n\n  var handleTitle = function handleTitle(event) {\n    var value = event.target.value;\n    setPost(_objectSpread(_objectSpread({}, post), {}, {\n      title: value\n    }));\n  };\n\n  var _useMutation = useMutation(id ? MODIFY_POST : CREATE_POST, {\n    onCompleted: function onCompleted() {\n      router.push(\"/\".concat(post.category));\n    }\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      EditPostMutation = _useMutation2[0];\n\n  var Submit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return EditPostMutation({\n                variables: id ? {\n                  id: id,\n                  input: post\n                } : {\n                  input: post\n                }\n              });\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function Submit() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var addImageBlobHook = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(blob, callback) {\n      var formData, _yield$service$post, data, elements, images;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              formData = new FormData();\n              formData.append(\"img\", blob);\n              _context2.next = 4;\n              return service.post(\"/upload\", formData);\n\n            case 4:\n              _yield$service$post = _context2.sent;\n              data = _yield$service$post.data;\n              callback(data.contents, \"image\");\n              elements = document.querySelectorAll(\".tui-editor-contents img\");\n              images = [];\n              elements.forEach(function (image) {\n                return images.push(image.src);\n              });\n              setImage(images);\n\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function addImageBlobHook(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var clickUploadInput = function clickUploadInput() {\n    if (!imageUploadRef.current) return;\n    imageUploadRef.current.click();\n  };\n\n  var uploadFile = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(event) {\n      var files, formData, _yield$service$post2, data, instance, elements, images;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              files = event.target.files;\n              formData = new FormData();\n\n              if (files && files.length > 0) {\n                Array.from(files).forEach(function (item) {\n                  formData.append(\"images\", item);\n                });\n              }\n\n              _context3.next = 5;\n              return service.post(\"/upload\", formData);\n\n            case 5:\n              _yield$service$post2 = _context3.sent;\n              data = _yield$service$post2.data;\n              instance = editorRef.current.getInstance();\n              data.forEach(function (item) {\n                instance.insertText(\"![image](\".concat(item.contents, \")\"));\n              });\n              elements = document.querySelectorAll(\".tui-editor-contents img\");\n              images = [];\n              elements.forEach(function (image) {\n                return images.push(image.src);\n              });\n              setImage(images);\n\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function uploadFile(_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    setPost(_objectSpread(_objectSpread({}, post), {}, {\n      image: image\n    }));\n  }, [image]);\n  return /*#__PURE__*/_jsxDEV(Wrap, {\n    children: [/*#__PURE__*/_jsxDEV(RowWrap, {\n      children: [/*#__PURE__*/_jsxDEV(SelectWrap, {\n        instanceId: \"select\",\n        value: options.filter(function (item) {\n          return item.value === post.category;\n        }),\n        onChange: handleSelect,\n        options: options,\n        isClearable: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(Button, {\n        onClick: clickUploadInput,\n        children: [\"\\uC774\\uBBF8\\uC9C0 \\uC5C5\\uB85C\\uB4DC\", /*#__PURE__*/_jsxDEV(\"input\", {\n          ref: imageUploadRef,\n          type: \"file\",\n          multiple: true,\n          onChange: uploadFile,\n          style: {\n            display: \"none\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(ButtonWrap, {\n        variant: id ? \"warning\" : \"success\",\n        height: 38,\n        onClick: Submit,\n        children: id ? \"수정\" : \"등록\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(RowWrap, {\n      children: /*#__PURE__*/_jsxDEV(TitleInput, {\n        onChange: handleTitle,\n        value: post.title,\n        placeholder: \"제목을 입력해주세요.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(EditorWithForwardedRef, {\n      initialValue: post.markdown,\n      previewStyle: \"vertical\",\n      height: \"600px\",\n      initialEditType: \"markdown\",\n      useCommandShortcut: true,\n      ref: editorRef,\n      previewHighlight: false,\n      onChange: handleChange,\n      hooks: {\n        addImageBlobHook: addImageBlobHook\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 136,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(WysiwygEditor, \"CBI9Uu489TIQ14B+/Njlrwtg0A4=\", false, function () {\n  return [useRouter, useQuery, useQuery, useMutation];\n});\n\n_c5 = WysiwygEditor;\nexport default _c6 = EmptyLayout(WysiwygEditor);\nvar Wrap = styled.div(_templateObject());\n_c7 = Wrap;\nvar RowWrap = styled.div(_templateObject2());\n_c8 = RowWrap;\nvar SelectWrap = styled(Select)(_templateObject3());\n_c9 = SelectWrap;\nvar ButtonWrap = styled(Button)(_templateObject4());\n_c10 = ButtonWrap;\nvar TitleInput = styled.input(_templateObject5());\n_c11 = TitleInput;\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c10, _c11;\n\n$RefreshReg$(_c, \"Editor$dynamic\");\n$RefreshReg$(_c2, \"Editor\");\n$RefreshReg$(_c3, \"EditorWithForwardedRef$React.forwardRef\");\n$RefreshReg$(_c4, \"EditorWithForwardedRef\");\n$RefreshReg$(_c5, \"WysiwygEditor\");\n$RefreshReg$(_c6, \"%default%\");\n$RefreshReg$(_c7, \"Wrap\");\n$RefreshReg$(_c8, \"RowWrap\");\n$RefreshReg$(_c9, \"SelectWrap\");\n$RefreshReg$(_c10, \"ButtonWrap\");\n$RefreshReg$(_c11, \"TitleInput\");","map":{"version":3,"sources":["/Users/loel/Documents/loel-blog/pages/edit/index.tsx"],"names":["dynamic","React","useEffect","useState","service","Select","EmptyLayout","Button","styled","useRouter","useMutation","useQuery","CREATE_POST","MODIFY_POST","GET_POST","GET_CATEGORIES","Editor","ssr","EditorWithForwardedRef","forwardRef","props","ref","WysiwygEditor","router","id","query","title","category","html","html2","email","markdown","post","setPost","image","setImage","options","setOptions","editorRef","useRef","imageUploadRef","fetchPolicy","onCompleted","data","dummy","getCategories","reduce","acc","cur","push","value","toLowerCase","label","variables","skip","getPost","user","handleChange","current","instance","getInstance","document","querySelector","innerHTML","getHtml","getMarkdown","handleSelect","newValue","handleTitle","event","target","EditPostMutation","Submit","input","addImageBlobHook","blob","callback","formData","FormData","append","contents","elements","querySelectorAll","images","forEach","src","clickUploadInput","click","uploadFile","files","length","Array","from","item","insertText","filter","display","Wrap","div","RowWrap","SelectWrap","ButtonWrap","TitleInput"],"mappings":"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","sourcesContent":["import dynamic from \"next/dynamic\";\nimport React, { useEffect, useState } from \"react\";\nimport service from \"../../utils/service\";\nimport Select, { ValueType, OptionTypeBase } from \"react-select\";\nimport { EmptyLayout } from \"layouts\";\nimport { Button } from \"styles\";\nimport { Editor as EditorType, EditorProps } from \"@toast-ui/react-editor\";\nimport { TuiEditorWithForwardedProps } from \"components/TuiEditorWrapper\";\n\nimport \"codemirror/lib/codemirror.css\";\nimport \"@toast-ui/editor/dist/toastui-editor.css\";\nimport \"tui-color-picker/dist/tui-color-picker.css\";\nimport \"highlight.js/styles/railscasts.css\";\nimport styled from \"styles/styled\";\nimport { useRouter } from \"next/router\";\nimport { useMutation, useQuery } from \"@apollo/react-hooks\";\nimport { CREATE_POST, MODIFY_POST, GET_POST } from \"@api/Post\";\nimport { GET_CATEGORIES } from \"@api/Category\";\n\ninterface EditorPropsWithHandlers extends EditorProps {\n  onChange?(value: string): void;\n}\n\nconst Editor = dynamic<TuiEditorWithForwardedProps>(() => import(\"components/TuiEditorWrapper\"), { ssr: false });\nconst EditorWithForwardedRef = React.forwardRef<EditorType | undefined, EditorPropsWithHandlers>((props, ref) => (\n  <Editor {...props} forwardedRef={ref as React.MutableRefObject<EditorType>} />\n));\n\nconst WysiwygEditor = () => {\n  const router = useRouter();\n  const { id } = router.query;\n\n  const [post, setPost] = useState<IPost>({ title: \"\", category: \"\", html: \"\", html2: \"\", email: \"ru_bryunak@naver.com\", markdown: \"\" });\n  const [image, setImage] = useState<string[]>([]);\n  const [options, setOptions] = useState<OptionTypeBase[]>([]);\n  const editorRef = React.useRef<EditorType>();\n  const imageUploadRef = React.useRef<HTMLInputElement | null>(null);\n\n  useQuery(GET_CATEGORIES, {\n    fetchPolicy: \"cache-first\",\n    onCompleted: (data) => {\n      const dummy = data.getCategories.reduce((acc: OptionTypeBase[], cur: ICategoryWithChildren) => {\n        acc.push({ value: cur.category.toLowerCase(), label: cur.category });\n        return acc;\n      }, []);\n      setOptions(dummy);\n    },\n  });\n\n  useQuery(GET_POST, {\n    fetchPolicy: \"network-only\",\n    variables: { id },\n    skip: !id,\n    onCompleted: (data) => {\n      const post = data.getPost;\n      setPost({ email: post.user.email, category: post.category, title: post.title, html: post.html, markdown: post.markdown, image: post.image, html2: post.html2 });\n    },\n  });\n\n  const handleChange = () => {\n    if (!editorRef.current) {\n      return;\n    }\n\n    const instance = editorRef.current.getInstance();\n    const html2 = document.querySelector(\".tui-editor-contents\")!.innerHTML;\n\n    setPost({ ...post, html: instance.getHtml(), html2, markdown: instance.getMarkdown() });\n  };\n\n  const handleSelect = (newValue: ValueType<OptionTypeBase, false>) => {\n    if (newValue) {\n      setPost({ ...post, category: newValue.value });\n    } else {\n      setPost({ ...post, category: null });\n    }\n  };\n\n  const handleTitle = (event: React.ChangeEvent<{ value: string }>) => {\n    const { value } = event.target;\n    setPost({ ...post, title: value });\n  };\n\n  const [EditPostMutation] = useMutation(id ? MODIFY_POST : CREATE_POST, {\n    onCompleted: () => {\n      router.push(`/${post.category}`);\n    },\n  });\n\n  const Submit = async () => {\n    await EditPostMutation({\n      variables: id ? { id, input: post } : { input: post },\n    });\n  };\n\n  const addImageBlobHook = async (blob: File | Blob, callback: (url: string, altText: string) => void) => {\n    const formData = new FormData();\n    formData.append(\"img\", blob);\n    const { data } = await service.post(\"/upload\", formData);\n    callback(data.contents, \"image\");\n    const elements = document.querySelectorAll(\".tui-editor-contents img\") as NodeListOf<HTMLImageElement>;\n    const images: string[] = [];\n    elements.forEach((image) => images.push(image.src));\n    setImage(images);\n  };\n\n  const clickUploadInput = () => {\n    if (!imageUploadRef.current) return;\n    imageUploadRef.current!.click();\n  };\n\n  const uploadFile = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files;\n    const formData = new FormData();\n    if (files && files.length > 0) {\n      Array.from(files).forEach((item) => {\n        formData.append(\"images\", item);\n      });\n    }\n    const { data } = await service.post(\"/upload\", formData);\n    const instance = editorRef.current!.getInstance();\n    data.forEach((item: any) => {\n      instance.insertText(`![image](${item.contents})`);\n    });\n    const elements = document.querySelectorAll(\".tui-editor-contents img\") as NodeListOf<HTMLImageElement>;\n    const images: string[] = [];\n    elements.forEach((image) => images.push(image.src));\n    setImage(images);\n  };\n\n  useEffect(() => {\n    setPost({ ...post, image });\n  }, [image]);\n\n  return (\n    <Wrap>\n      <RowWrap>\n        <SelectWrap instanceId={\"select\"} value={options.filter((item) => item.value === post.category)} onChange={handleSelect} options={options} isClearable={true} />\n        <Button onClick={clickUploadInput}>\n          이미지 업로드\n          <input ref={imageUploadRef} type={\"file\"} multiple={true} onChange={uploadFile} style={{ display: \"none\" }} />\n        </Button>\n        <ButtonWrap variant={id ? \"warning\" : \"success\"} height={38} onClick={Submit}>\n          {id ? \"수정\" : \"등록\"}\n        </ButtonWrap>\n      </RowWrap>\n      <RowWrap>\n        <TitleInput onChange={handleTitle} value={post.title} placeholder={\"제목을 입력해주세요.\"} />\n      </RowWrap>\n      <EditorWithForwardedRef\n        initialValue={post.markdown}\n        previewStyle={\"vertical\"}\n        height={\"600px\"}\n        initialEditType={\"markdown\"}\n        useCommandShortcut={true}\n        ref={editorRef}\n        previewHighlight={false}\n        onChange={handleChange}\n        hooks={{ addImageBlobHook }}\n      />\n    </Wrap>\n  );\n};\n\nexport default EmptyLayout(WysiwygEditor);\n\nconst Wrap = styled.div`\n  width: 100%;\n`;\n\nconst RowWrap = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n`;\n\nconst SelectWrap = styled(Select)`\n  margin-right: 1rem;\n  width: 300px;\n  font-size: 0.875rem;\n  z-index: 3;\n\n  > div {\n    border-color: #e5e5e5;\n  }\n`;\n\nconst ButtonWrap = styled(Button)`\n  margin-left: auto;\n`;\n\nconst TitleInput = styled.input`\n  margin: 0;\n  padding: 0 0.5rem;\n  width: 100%;\n  height: 2.5rem;\n  font-size: 0.875rem;\n  font-weight: 400;\n  border: 1px solid #e5e5e5;\n  border-radius: 4px;\n\n  :hover,\n  :focus {\n    border-color: hsl(0, 0%, 70%);\n  }\n`;\n"]},"metadata":{},"sourceType":"module"}