{"ast":null,"code":"import _taggedTemplateLiteral from \"@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction _templateObject21() {\n  var data = _taggedTemplateLiteral([\"\\n  font-size: 1.2rem;\\n  line-height: 1.5;\\n\"]);\n\n  _templateObject21 = function _templateObject21() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject20() {\n  var data = _taggedTemplateLiteral([\"\\n  font-size: 0.875rem;\\n  color: #8a8a8a;\\n\"]);\n\n  _templateObject20 = function _templateObject20() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject19() {\n  var data = _taggedTemplateLiteral([\"\\n  font-weight: 600;\\n  margin-bottom: 5px;\\n\"]);\n\n  _templateObject19 = function _templateObject19() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject18() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n  margin-bottom: 1.5rem;\\n\"]);\n\n  _templateObject18 = function _templateObject18() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject17() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  margin-bottom: 1.5rem;\\n  padding-bottom: 1.5rem;\\n  border-bottom: 1px solid #efefef;\\n\"]);\n\n  _templateObject17 = function _templateObject17() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject16() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 0;\\n  padding: 2px 10px;\\n  height: 38px;\\n  font-size: 1rem;\\n  color: #4c4c4c;\\n  line-height: 1.2;\\n  \", \"\\n\\n  + input {\\n    margin-left: 1rem;\\n  }\\n\"]);\n\n  _templateObject16 = function _templateObject16() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject15() {\n  var data = _taggedTemplateLiteral([\"\\n  margin-bottom: 1rem;\\n\"]);\n\n  _templateObject15 = function _templateObject15() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject14() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 1.5rem 0 3rem;\\n\"]);\n\n  _templateObject14 = function _templateObject14() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject13() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: flex-end;\\n\"]);\n\n  _templateObject13 = function _templateObject13() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject12() {\n  var data = _taggedTemplateLiteral([\"\\n  margin-bottom: 1rem;\\n  padding: 0.625rem;\\n  width: 100%;\\n  min-height: 5rem;\\n  font-size: 1rem;\\n  line-height: 1.75;\\n  \", \"\\n  resize: none;\\n\"]);\n\n  _templateObject12 = function _templateObject12() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject11() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 0.5rem 0.5rem 1rem;\\n  font-weight: 500;\\n\"]);\n\n  _templateObject11 = function _templateObject11() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject10() {\n  var data = _taggedTemplateLiteral([\"\\n  padding-bottom: 2rem;\\n\"]);\n\n  _templateObject10 = function _templateObject10() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"\\n  margin-left: auto;\\n\\n  button + button {\\n    margin-left: 0.5rem;\\n  }\\n\"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"\\n  font-size: 1rem;\\n\\n  img {\\n    display: block;\\n    max-width: 768px;\\n  }\\n\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n  margin-right: 10px;\\n  font-weight: 600;\\n\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  font-size: 1rem;\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n  font-size: 2.5rem;\\n  line-height: 1.5;\\n  font-weight: 800;\\n  color: #313131;\\n  word-break: keep-all;\\n  margin-bottom: 2rem;\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  margin-bottom: 1rem;\\n  padding-bottom: 2rem;\\n  border-bottom: 1px solid #eee;\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  width: 100%;\\n  padding: 2rem 0;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  border: 1px solid #e4e4e4;\\n  border-radius: 4px;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState } from \"react\";\nimport styled from \"styles/styled\";\nimport { DefaultLayout } from \"layouts\";\nimport { useRouter } from \"next/router\";\nimport Head from \"next/head\";\nimport \"codemirror/lib/codemirror.css\";\nimport \"@toast-ui/editor/dist/toastui-editor.css\";\nimport { Button } from \"styles\";\nimport { useQuery, useMutation } from \"@apollo/react-hooks\";\nimport { REMOVE_POST, CREATE_COMMENT, GET_COMMENTS, GET_ALL_POSTS } from \"@api/Post\";\nimport \"prismjs/themes/prism.css\";\nimport { decodeHTMLForHeader, dateDisplay } from \"@utils/common\";\nimport { css } from \"@emotion/core\";\n\nvar Post = function Post(_ref) {\n  var authority = _ref.authority,\n      post = _ref.post;\n  var router = useRouter();\n\n  if (router.isFallback) {\n    return /*#__PURE__*/_jsx(\"div\", {\n      children: \"Loading...\"\n    });\n  }\n\n  var id = post.id.toString();\n\n  var _useState = useState(null),\n      comments = _useState[0],\n      setComments = _useState[1];\n\n  var _useState2 = useState({\n    name: \"\",\n    password: \"\",\n    contents: \"\",\n    \"class\": 0\n  }),\n      comment = _useState2[0],\n      setComment = _useState2[1];\n\n  useQuery(GET_COMMENTS, {\n    fetchPolicy: \"cache-first\",\n    variables: {\n      postId: id\n    },\n    onCompleted: function onCompleted(data) {\n      setComments(data.getComments);\n    }\n  });\n\n  var _useMutation = useMutation(REMOVE_POST, {\n    refetchQueries: [{\n      query: GET_ALL_POSTS\n    }],\n    onCompleted: function onCompleted() {\n      router.push(\"/\");\n    }\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      RemovePostMutation = _useMutation2[0];\n\n  var pushEditPage = function pushEditPage() {\n    router.push(\"/edit?id=\".concat(id));\n  };\n\n  var remove = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return RemovePostMutation({\n                variables: {\n                  id: id\n                }\n              });\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function remove() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var autoIncreaseHeight = function autoIncreaseHeight(event) {\n    var target = event.target;\n    target.style.height = \"\".concat(target.scrollHeight + 2, \"px\");\n  };\n\n  var handleCommentInput = function handleCommentInput(event) {\n    var _event$target = event.target,\n        name = _event$target.name,\n        value = _event$target.value;\n    setComment(_objectSpread(_objectSpread({}, comment), {}, _defineProperty({}, name, value)));\n  };\n\n  var _useMutation3 = useMutation(CREATE_COMMENT, {\n    refetchQueries: [{\n      query: GET_COMMENTS,\n      variables: {\n        postId: id\n      }\n    }],\n    awaitRefetchQueries: true,\n    update: function update(store, _ref3) {\n      var createComment = _ref3.data.createComment;\n      var newComments = comments ? [createComment].concat(_toConsumableArray(comments)) : null;\n      setComments(newComments);\n    },\n    onCompleted: function onCompleted() {\n      setComment({\n        name: \"\",\n        password: \"\",\n        contents: \"\",\n        \"class\": 0\n      });\n    }\n  }),\n      _useMutation4 = _slicedToArray(_useMutation3, 1),\n      CreateCommentMutation = _useMutation4[0];\n\n  var registerComment = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var name, password, contents, user;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              name = comment.name, password = comment.password, contents = comment.contents;\n\n              if (name) {\n                _context2.next = 4;\n                break;\n              }\n\n              alert(\"닉네임을 입력해주세요.\");\n              return _context2.abrupt(\"return\");\n\n            case 4:\n              if (password) {\n                _context2.next = 7;\n                break;\n              }\n\n              alert(\"비밀번호를 입력해주세요.\");\n              return _context2.abrupt(\"return\");\n\n            case 7:\n              if (contents) {\n                _context2.next = 10;\n                break;\n              }\n\n              alert(\"댓글 내용을 입력해주세요.\");\n              return _context2.abrupt(\"return\");\n\n            case 10:\n              user = JSON.parse(localStorage.getItem(\"user\"));\n              _context2.next = 13;\n              return CreateCommentMutation({\n                variables: {\n                  comment: comment,\n                  postId: id,\n                  email: user && user.email ? user.email : \"\"\n                }\n              });\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function registerComment() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(Head, {\n      children: [/*#__PURE__*/_jsx(\"link\", {\n        rel: \"canonical\",\n        href: \"https://www.loelblog.com/post/\".concat(id)\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        name: \"title\",\n        content: \"Loel's Blog \".concat(post ? \" - \" + post.title : \"\")\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        name: \"description\",\n        content: decodeHTMLForHeader(post ? post.html : \"음식과 여행을 좋아하는 개발자의 블로그 입니다.\")\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        property: \"og:title\",\n        content: \"Loel's Blog \".concat(post ? \" - \" + post.title : \"\")\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        property: \"og:type\",\n        content: \"article\"\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        property: \"og:url\",\n        content: \"https://www.loelblog.com/post/\".concat(id)\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        property: \"og:description\",\n        content: decodeHTMLForHeader(post ? post.html : \"음식과 여행을 좋아하는 개발자의 블로그 입니다.\")\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        property: \"og:image\",\n        content: \"https://images.loelblog.com/thumb/background.jpg\"\n      }), /*#__PURE__*/_jsx(\"title\", {\n        children: \"Loel's Blog \".concat(post ? \" - \" + post.title : \"\")\n      })]\n    }), post && /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsxs(PostWrap, {\n        children: [/*#__PURE__*/_jsxs(HeadWrap, {\n          children: [/*#__PURE__*/_jsx(Title, {\n            children: post.title\n          }), /*#__PURE__*/_jsxs(InfoWrap, {\n            children: [/*#__PURE__*/_jsx(Author, {\n              children: post.email\n            }), /*#__PURE__*/_jsx(CreatedAt, {\n              children: dateDisplay(post.updatedAt)\n            }), authority && /*#__PURE__*/_jsxs(EditWrap, {\n              children: [/*#__PURE__*/_jsx(Button, {\n                onClick: pushEditPage,\n                variant: \"warning\",\n                children: \"\\uC218\\uC815\"\n              }), /*#__PURE__*/_jsx(Button, {\n                onClick: remove,\n                variant: \"danger\",\n                children: \"\\uC0AD\\uC81C\"\n              })]\n            })]\n          })]\n        }), /*#__PURE__*/_jsx(ContentWrap, {\n          className: \"tui-editor-contents\",\n          dangerouslySetInnerHTML: {\n            __html: post.html2 ? post.html2 : post.html\n          }\n        })]\n      }), /*#__PURE__*/_jsxs(CommentRegisterWrap, {\n        children: [/*#__PURE__*/_jsxs(TotalComment, {\n          children: [\"\\uB313\\uAE00 \", comments ? comments.length : 0]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsxs(CommentWriterWrap, {\n            children: [/*#__PURE__*/_jsx(CommentWriterInput, {\n              name: \"name\",\n              maxLength: 40,\n              value: comment.name,\n              onChange: handleCommentInput,\n              placeholder: \"닉네임\"\n            }), /*#__PURE__*/_jsx(CommentWriterInput, {\n              name: \"password\",\n              maxLength: 40,\n              value: comment.password,\n              onChange: handleCommentInput,\n              placeholder: \"비밀번호\"\n            })]\n          }), /*#__PURE__*/_jsx(InputComment, {\n            name: \"contents\",\n            value: comment.contents,\n            onChange: handleCommentInput,\n            onInput: autoIncreaseHeight,\n            placeholder: \"댓글을 남겨주세요.\"\n          }), /*#__PURE__*/_jsx(CommentRegisterButton, {\n            children: /*#__PURE__*/_jsx(Button, {\n              variant: \"success\",\n              width: 120,\n              height: 40,\n              onClick: registerComment,\n              children: \"\\uB313\\uAE00 \\uC791\\uC131\"\n            })\n          })]\n        })]\n      }), /*#__PURE__*/_jsx(CommentsWrap, {\n        children: comments && comments.length > 0 && comments.map(function (item) {\n          return /*#__PURE__*/_jsxs(CommentWrap, {\n            children: [/*#__PURE__*/_jsxs(CommentInfoWrap, {\n              children: [/*#__PURE__*/_jsx(CommentWriterName, {\n                children: item.name\n              }), /*#__PURE__*/_jsx(CommentCreatedAt, {\n                children: dateDisplay(item.createdAt)\n              })]\n            }), /*#__PURE__*/_jsx(Comment, {\n              children: item.contents\n            })]\n          }, item.id);\n        })\n      })]\n    })]\n  });\n};\n\nexport var __N_SSG = true;\nexport default DefaultLayout(Post);\nvar Border = css(_templateObject());\nvar PostWrap = styled.section(_templateObject2());\nvar HeadWrap = styled.div(_templateObject3());\nvar Title = styled.h1(_templateObject4());\nvar InfoWrap = styled.div(_templateObject5());\nvar Author = styled.span(_templateObject6());\nvar CreatedAt = styled.span(_templateObject7());\nvar ContentWrap = styled.article(_templateObject8());\nvar EditWrap = styled.div(_templateObject9());\nvar CommentRegisterWrap = styled.div(_templateObject10());\nvar TotalComment = styled.div(_templateObject11());\nvar InputComment = styled.textarea(_templateObject12(), Border);\nvar CommentRegisterButton = styled.div(_templateObject13());\nvar CommentsWrap = styled.div(_templateObject14());\nvar CommentWriterWrap = styled.div(_templateObject15());\nvar CommentWriterInput = styled.input(_templateObject16(), Border);\nvar CommentWrap = styled.div(_templateObject17());\nvar CommentInfoWrap = styled.div(_templateObject18());\nvar CommentWriterName = styled.div(_templateObject19());\nvar CommentCreatedAt = styled.div(_templateObject20());\nvar Comment = styled.div(_templateObject21());","map":null,"metadata":{},"sourceType":"module"}